# TCL
## 1. 트랜잭션의 개요
- 데이터베이스의 논리적 연산단위
- 밀접한 관련되어 분리될 수 없는 한 개 이상의 데이터베이스 조작을 가리킨다. => ALL or NOTHING
- 하나의 논리적인 작업 단위를 구성하는 세부적인 연산들의 집합

- 트랜잭션의 특성
	- 원자성 : 트랜잭션에서 정의된 연산들은 모두 성공적으로 실행되던지, 전혀 실행되지 않은 상태로 존재
	- 일관성 : 트랜잭션이 실행되기 전, 데이터베이스 내용이 잘못 되어 있지 않다면 트랜잭션 이후에도 잘못된 내용이 있으면 안 됨.
	- 고립성 : 트랜잭션 실행 도중 다른 트랜잭션의 영향을 받아선 안 됨.
	- 지속성 : 트랜잭션이 성공적을 수행되면, 트랜잭션이 갱시나 데이터베이스으 내용은 영구적으로 저장됨.

- 잠금(Locking) : 트랜잭션의 원자성 특성을 충족하기 위해, 기본적으로 트랜잭션이 수행하는 동안 특저 데이터에 대해서 다른 트랜잭션이 동시에 접근하지 못하도록 제한하는 기법

## 2. COMMIT
- 입력한 자료나 수정한 자료에 대해 문제 없다고 판단된 경우, COMMIT 명령어를 통해 트랜잭션을 완료함.
- COMMIT / ROLLBACK 이전의 데이터 상태
	- 단지 메모리 buffer에만 영향을 받기 때문에 데이터의 변경 이전 상태로 복구가 가능
	- 현재 사용자는 select문장으로 결과를 확인 가능
	- 다른 사용자는 현재 사용자가 수행한 명령의 결과를 볼 수 없음.
	- 변경된 행은 잠금이 설정되어서 다른 사용자가 변경할 수 없다.

- COMMIT의 사용 : 변경작업이 완료되었음을 데이터베이스에 알려 주기 위함.
- COMMIT 이후의 데이터 상태
	- 데이터에 대한 변경사항이 데이터베이스에 반영
	- 이전 데이터 완전 소실
	- 모든 사용자가 결과를 볼 수 있다
	- 관련된 행에 잠금이 풀리고, 다른 사용자들이 행을 조작할 수 있게 된다.

- SQL Server의 COMMIT
	- AUTO COMMIT 모드 : DML 구문이 성공이면 자동을 커밋이 되고 오류가 발생하 경우 자동으로 롤백 처리
	- SQL Server 트랜잭션의 3가지 방식
		1) AUTO COMMIT : DML, DDL을 수행할 때마다 DBMS가 트랜잭션을 컨트롤 하는 방식. / 명령어가 성공적으로 수행되면 자동 커밋, 오류가 발생하면 자동 롤백 수행.
		2) 암시적 트랜잭션 : 트랜잭션의 시작은 DBMS가 처리하고 트랜잭션의 끝은 사용자가 명시적으로 커밋 또는 롤백을 처리.
		3) 명시적 트랜잭션 : 트랜잭션 시작과 끝을 사용자가 명시적으로 지정하는 방식. / BEGIN TRANSACTION 으로 트랜잭션 시작 COMMIT TRANSACTION 또는 ROLLBACK TRANSACTION으로 트랜잭션 종료 

## 3. ROLLBACK
- 데이터 변경 사항이 취소되어 데이터의 이전상태로 복구되며, 관련된 행에 대한 잠금(locking)이 풀리고 다른 사용자들이 데이터를 변경 할 수 있게 된다.
- Rollback 이후의 데이터 상태
	- 데이터에 대하 변경 사항 취소
	- 이전 데이터는 다시 재저장
	- 관련된 행에 대한 잠금해제, 다른 트랜잭션의 데이터 조작이 가능
- COMMIT과 ROLLBACK의 효과
	- 데이터 무결성 보장
	- 영구적인 변경을 하기 전에 데이터의 변경 사항 확인 가능
	- 논리적으로 연관된 작업을 그룹핑하여 처리 가능

## 4. SAVEPOINT
- 저장점을 정의하면 롤백할 때 트랜잭션에 포함된 전체 작업을 롤백하는 것이 아니라 현 시점에서 savepoint까지 트랜잭션의 일부만 롤백할 수 있다
- 복수의 저장점을 정의할 수 있음
- 동일이름으로 저장점을 정의했을 때, 나중의 정의한 저장점이 유효함

- [oracle] SAVEPOINT SVPT1;
- [SQL Server] SAVEPOINT TRANSACTION SVPT1;
	
