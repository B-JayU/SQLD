# 반정규화와 성능
## 1. 반정규화를 통한 성능향상 전략
### 반정규화의 정의
#### 정의
- 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발과 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법을 의미.
- 협의의 반정규화 : 데이터를 중복하여 성능을 향상시키기 위한 기법
- 넓은 의미의 반정규화 : 성능을 향상시키기 위해 정규화된 데이터 모델에서 중복, 통합, 분리 등을 수행하는 모든 과정을 의미
#### 장단점
- 장점 : 디스크 I/O가 많아서 성능저하, 경로가 너무 멀어 조인을 인한 성능저하, 칼럼을 계산하여 읽을 때 성능저하 등을 줄여준다.( 복잡한 조인을 사용하지 않고 SQL문장을 단순처리하기 위함.)
- 단점 : 데이터 무결성을 저해 할 수 있다.

### 반정규화의 적용방법

- 1. 반정규화의 대상을 조사한다.
-     1) 자주 사용되는 테이블에 접근하는 프로세스가 많고, 항상 일정한 범위만 조회하는 경우
-     2) 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우, 데이터 범위를 축소하기
-     3) 통계성 프로세스 ( 통계테이블을 생성한다.)
-     4) 테이블에 지나치게 많은 조인이 걸려 있는 경우

- 2. 반정규화의 대상에 대해 다른 방법을 처리할 수 있는지 검토한다.
-     1) 성능을 고려한 뷰를 생성하여 개발자가 뷰를 통해 접근하게 함으로써 성능저하의 위험을 예방
-     2) 조회중심의 테이블이라면 클러스터링 방식을 적용( 대량의 데이터를 특정 클러스터링 팩트에 의해 저장방식을 다르게 하는 방법 )
-     3) 인덱스 조정을 통한 반정규화 회피
-     4) 파티셔닝(partitioning) 기법: 인위적인 테이블을 통합/분리하지 않고 물리적인 저장기법에 따라 성능을 향상시키는 기법
-         데이터가 파티셔닝 키에 따라 다르게 저장되고 파티셔닝 키에 따른 조회가 될 때 성능이 좋아진다. 
-     5) 응용 애플리케이션에서 로직을 구사하는 방법을 변경한다.
-         응용 메모 영역에 데이터를 처리하기 위한 값, 중간 클래스 영역에 데이터를 캐쉬하여 공유하게 한다.

- 3. 반정규화를 적용한다.

## 2. 반정규화의 기법
### 테이블 반정규화
#### 테이블 병합
- 1:1, 1:M, 슈퍼/서브타입 테이블병합
#### 테이블 분할
- 수직분할, 수평분할
#### 테이블 추가
- 중복테이블 추가, 통계테이블 추가, 이력테이블 추가, 부분테이블 추가

### 칼럼 반정규화
- 중복 칼럼 추가
-     조인을 감소시키기 위해 중복된 칼럼을 위치시킴
- 파생 칼럼 추가
-     계산에 의해 발생되는 성능저하를 예방하기 위해, 계산값을 칼럼에 보관함(Derived Column)
- 이력테이블 칼럼 추가
-     이력데이터 처리 시 불특정 날 조회나 최근 값을 조회할 때 나타날 수 있는 성능저하를 예방하기 위해 이력테이블에 기능성 칼럼(최근값 여부, 시작과 종료일자 등)을 추가함
- PK에 의한 칼럼 추가
-     PK안에 데이터가 존재하지만 성능향상을 위해 일반속성을 포함하는 방법
- 응용시스템 오작동을 위한 칼럼 추가
-     원래 값으로 복구하기 위해, 이전 데이터를 임시적으로 중복하여 저장하는 방법

### 관계 반정규화
- 중복관계 추가
-     여러 경로를 거쳐 조인이 가능하지만 이 때 발생할 수 있는 성능저하를 예방하기 위해 추가적인 관계를 맺는 방법
-     테이블,칼럽 반정규화는 데이터 무결성에 영향을 미치게 되나 관계의 반정규화는 데이터 무결성을 깨뜨릴 위험을 갖지 않고서 데이터 처리 성능을 향상시킬 수 있다. 

## 3. 정규화가 잘 정의된 데이터 모델에서 성능이 저하될 수 있는 경우
- 1:M 관계에서 하나의 foreign key에 대해 여러 개의 row가 분류될 때, 그 중 가장 최근 변경된 값 하나만을 유효로 하는 경우
- SQLD_기본서통합본 p.63 참고

## 4. 정규화가 잘 정의된 데이터 모델에서 성능이 저하된 경우
- 분산데이터베이스가 구성되어 있는 경우 
- SQLD_기본서통합본 p.64 참고
