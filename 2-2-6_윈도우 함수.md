# 윈도우 함수
## 1. WINDOW FUNCTION 개요
- 분석 함수나 순위 함수
- 다른 함수와는 달리 중첩해서 사용 불가x, 서브쿼리에서 사용가능
- window 함수 종류
  - 순위 함수
  - 집계 함수
  - 순서 함수
  - 비율 함수
- window function syntax
  - window 함수에는 over 문구가 키워드로 필수 포함
  - SELECT WINDOW_FUNCTION (ARGUMENTS) OVER ([PARTITION BY 칼럼] [ORDER BY 절] [WINDOWING 절]) FROM 테이블명
    - PARTITION BY 절 : 전체 집합을 기준에 의해 소그룹으로 나눌 수 있다
    - ORDER BY 절 : 어떠 항목에 ㄷ해 순위를 지정할 지 ORDER BY 절을 기술한다.
    - WINDOWING 절 : WINDOWING절은 함수의 대상이 되는 행 기준의 범위를 강력하게 지정

## 2. 그룹 내 순위 함수 
### 가. RANK 함수
- ORDER BY를 포함한 QUERY 문에서 특정 항목(칼럼)에 대한 순위를 구함.
- 특정 범위(PARTITION) 내ㅔ서 순위를 구할 수도 있고, 전체 데이터에 대한 순위를 구할 수도 있음.
- 동일한 값에 대해서는 동일한 순위를 부여
### 나. DENSE_RANK 함수
- RANK 함수와 흡사하나, 동일한 순위를 하나의 건수로 취급하는 것이 다름
### 다. ROW_NUMBER 함수
- 동일한 순위를 인정하지 않는 등수
- 동일한 순위를 배제하기 위해 유니크한 순위를 정함.

## 3. 일반 집계 함수 (SQLD_기본서 통합본 예제 확인하기)
### 가. SUM 함수
- 파티션별 윈도우의 합
- Ex) 같은 매니저를 두고 있는 사원들의 SALARY 합
  - SUM(SALARY) OVER (PARTITION BY MGR) MGR_SUM
- Ex) OVER 절 내에 ORDER BY 절을 추가해 파티션 내 데잍터를 정렬하고 이전 SALARY 데이터까지의 누적값을 출력
  - SUM(SALARY) OVER (PARTITION BY MGR ORDER BY SALARY RANGE UNBOUNDED PRECEDING) as MGR_SUM FROM EMP 
### 나. MAX 함수
-  파티션별 윈도우의 최대값
### 다. MIN 함수
-  파티션별 윈도우의 최소값
### 라. AVG 함수
-  AVG 함수와 파티션별 ROWS 윈도우를 이용해 원하는 조건에 맞는 데이터에 대한 통계값을 구할 수 있다.
### 마. COUNT 함수
-  COUNT 함수와 파티션별 ROWS 윈도우를 이용해 원하는 조건에 맞는 데이터에 대한 통계값을 구할 수 있다.

## 4. 그룹 내 행 순서 함수
### 가. FIRST_VALUE 함수
- 파티션별 윈도우에서 가장 먼저 나온 값을 구한다
- MIN 함수를 활용하여 같은 결과를 얻을 수도 있다
- 공동 등수를 인정하지 않기 때문에 공동 등수가 있을 경우 별도의 정렬 조건을 추가
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
### 나. LAST_VALUE 함수
- 파티션별 윈도우에서 가장 나중에 나온 값
- MAX 함수를 활용하여 같은 결과를 얻을 수도 있다
- 공동 등수를 인정하지 않기 때문에 공동 등수가 있을 경우 별도의 정렬 조건을 추가
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
### 다. LAG 함수
- 파티션별 윈도우에서 이전 몇 번째 행의 값을 가져오기
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
- EX) LAG(SAL, 2, 0)
  - 두번째 인자 '2' : 기준 행으로 부터 2번째 앞의 행을 가져올 것을 결정
  - 세번째 인자 '0' : 가져올 데이터가 없어 NULL 값이 들어오는 경우, 다른값으로 바꿀 값
### 라. LEAD 함수
- 파티션별 윈도우에서 이후 몇 번째 행의 값을 가져오기
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
- EX) LEAD(SAL, 2, 0)
  - 두번째 인자 '2' : 기준 행으로 부터 2번째 뒤의 행을 가져올 것을 결정 (DEFAULT 1)
  - 세번째 인자 '0' : 가져올 데이터가 없어 NULL 값이 들어오는 경우, 다른값으로 바꿀 값

## 5. 그룹 내 비율 함수
### 가. RATIO_TO_REPORT 함수
- 파티션 내 전체 SUM(칼럼)값에 대한 행별 칼럼 값의 백분율을 소수점으로 구할 수 있다.
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
### 나. PERCENT_RANK 함수
- 파티션별 윈도우에서 제일 먼저 나오는 것을 0, 제일 늦게 나오는 것을 1
- 행의 순서별 백분율을 구한다.
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
### 다. CUME_DIST 함수
- 파티션별 윈도우의 전체건수에서 현재 행보다 작거나 같은 건수에 대한 누적백분율을 구한다.
- 결과 값은 > 0 & <= 1의 범위 (SQL Server에서 지원x)
### 라. NTILE 함수
- 파티션별 전체 건수를 ARGUMENT 값으로 N 등분한 결과를 구할 수 있다.
- 나누어 떨어지지 않는 경우 앞의 조부터 할당한다.
